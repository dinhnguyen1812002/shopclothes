{"ast":null,"code":"var _jsxFileName = \"C:\\\\Users\\\\MSI-PC\\\\Downloads\\\\doanjs\\\\MERN_Store\\\\New folder\\\\client-mernstore\\\\src\\\\components\\\\pages\\\\OTPInput.js\",\n  _s = $RefreshSig$();\nimport React, { useState, useEffect } from \"react\";\nimport axios from \"axios\";\nimport { API_URL } from '../../config';\nimport './loading.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nexport default function OTPInput() {\n  _s();\n  const isLoggedIn = localStorage.getItem('isLoggedIn');\n  const email_resetPass = localStorage.getItem('email_resetPass');\n  if (isLoggedIn) {\n    window.location.href = '/';\n  }\n  const [OTPinput, setOTPinput] = useState(\"\");\n  const [disable, setDisable] = useState(true);\n  const [timerCount, setTimer] = useState(60);\n  const [isLoading, setIsLoading] = useState(false);\n\n  //function to verify OTP\n  function verifyOTP() {\n    if (OTPinput === localStorage.getItem('otp')) {\n      localStorage.setItem('success_reset', true);\n      window.location.href = '/reset';\n    } else {\n      alert(\"Mã bạn nhập không chính xác, vui lòng thử lại hoặc gửi lại liên kết\");\n    }\n  }\n\n  //function to resend OTP \n  function resendOTP() {\n    if (disable) return;\n    setIsLoading(true);\n    const OTP = Math.floor(Math.random() * 9000 + 1000);\n    axios.post(`${API_URL}/api/users/send_email`, {\n      OTP: OTP,\n      recipient_email: email_resetPass\n    }).then(() => {\n      localStorage.setItem('otp', OTP);\n      setDisable(true);\n      alert(\"Một OTP mới đã được gửi thành công đến email của bạn.\");\n      setTimer(60);\n    }).catch(console.log);\n    setIsLoading(false);\n  }\n  //timer function\n  useEffect(() => {\n    let interval = setInterval(() => {\n      setTimer(lastTimerCount => {\n        lastTimerCount <= 1 && clearInterval(interval);\n        if (lastTimerCount <= 1) {\n          setDisable(false);\n          localStorage.removeItem('otp');\n        }\n        return lastTimerCount - 1;\n      });\n    }, 1000);\n    return () => clearInterval(interval);\n  }, [disable]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [isLoading && /*#__PURE__*/_jsxDEV(\"div\", {\n      class: \"loading\",\n      children: \"Loading\\u2026\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 68,\n      columnNumber: 9\n    }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"container row mt-4 mb-4\",\n      children: [/*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 71,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-6\",\n        children: [/*#__PURE__*/_jsxDEV(\"h3\", {\n          children: \"Email x\\xE1c th\\u1EF1c\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 73,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          children: \"Ch\\xFAng t\\xF4i \\u0111\\xE3 g\\u1EEDi m\\xE3 x\\xE1c minh t\\u1EDBi email c\\u1EE7a b\\u1EA1n.\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 74,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"input\", {\n          type: \"text\",\n          className: \"form-control\",\n          value: OTPinput,\n          onChange: e => {\n            setOTPinput(e.target.value);\n          }\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 75,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n          className: \"btn btn-primary mt-2\",\n          onClick: () => verifyOTP(),\n          children: \"X\\xE1c nh\\u1EADn t\\xE0i kho\\u1EA3n\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 76,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"a\", {\n          className: \"mt-2\",\n          onClick: () => resendOTP(),\n          children: [\" Kh\\xF4ng nh\\u1EADn \\u0111\\u01B0\\u1EE3c m\\xE3?\", disable ? `Gửi lại OTP trong ${timerCount}s` : \" Gửi lại OTP\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 78,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 72,\n        columnNumber: 9\n      }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"col-md-3\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 9\n      }, this)]\n    }, void 0, true, {\n      fileName: _jsxFileName,\n      lineNumber: 70,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true);\n}\n_s(OTPInput, \"5a++CSOXF8P1wKzzYnuN7SKX5Xo=\");\n_c = OTPInput;\nvar _c;\n$RefreshReg$(_c, \"OTPInput\");","map":{"version":3,"names":["React","useState","useEffect","axios","API_URL","jsxDEV","_jsxDEV","Fragment","_Fragment","OTPInput","_s","isLoggedIn","localStorage","getItem","email_resetPass","window","location","href","OTPinput","setOTPinput","disable","setDisable","timerCount","setTimer","isLoading","setIsLoading","verifyOTP","setItem","alert","resendOTP","OTP","Math","floor","random","post","recipient_email","then","catch","console","log","interval","setInterval","lastTimerCount","clearInterval","removeItem","children","class","fileName","_jsxFileName","lineNumber","columnNumber","className","type","value","onChange","e","target","onClick","_c","$RefreshReg$"],"sources":["C:/Users/MSI-PC/Downloads/doanjs/MERN_Store/New folder/client-mernstore/src/components/pages/OTPInput.js"],"sourcesContent":["\r\nimport React, { useState, useEffect } from \"react\";\r\nimport axios from \"axios\";\r\nimport { API_URL } from '../../config';\r\nimport './loading.css';\r\n\r\nexport default function OTPInput() {\r\n  const isLoggedIn = localStorage.getItem('isLoggedIn');\r\n  const email_resetPass = localStorage.getItem('email_resetPass');\r\n  if (isLoggedIn) {\r\n    window.location.href = '/';\r\n  }\r\n\r\n  const [OTPinput, setOTPinput] = useState(\"\");\r\n  const [disable, setDisable] = useState(true);\r\n  const [timerCount, setTimer] = useState(60);\r\n  const [isLoading, setIsLoading] = useState(false);\r\n\r\n  //function to verify OTP\r\n  function verifyOTP() {\r\n    if (OTPinput === localStorage.getItem('otp')) {\r\n      localStorage.setItem('success_reset', true);\r\n      window.location.href = '/reset';\r\n    } else {\r\n      alert(\"Mã bạn nhập không chính xác, vui lòng thử lại hoặc gửi lại liên kết\");\r\n    }\r\n  }\r\n\r\n  //function to resend OTP \r\n  function resendOTP() {\r\n    if (disable) return;\r\n    setIsLoading(true);\r\n    const OTP = Math.floor(Math.random() * 9000 + 1000);\r\n    axios\r\n      .post(`${API_URL}/api/users/send_email`, {\r\n        OTP: OTP,\r\n        recipient_email: email_resetPass,\r\n      })\r\n      .then(() => {\r\n        localStorage.setItem('otp', OTP);\r\n        setDisable(true);\r\n        alert(\"Một OTP mới đã được gửi thành công đến email của bạn.\");\r\n        setTimer(60);\r\n      })\r\n      .catch(console.log);\r\n    setIsLoading(false);\r\n  }\r\n  //timer function\r\n  useEffect(() => {\r\n    let interval = setInterval(() => {\r\n      setTimer(lastTimerCount => {\r\n        lastTimerCount <= 1 && clearInterval(interval);\r\n        if (lastTimerCount <= 1) {\r\n          setDisable(false);\r\n          localStorage.removeItem('otp');\r\n        }\r\n        return lastTimerCount - 1;\r\n      });\r\n    }, 1000);\r\n\r\n    return () => clearInterval(interval);\r\n  }, [disable]);\r\n\r\n  return (\r\n    <>\r\n      {\r\n        isLoading &&\r\n        <div class=\"loading\">Loading&#8230;</div>\r\n      }\r\n      <div className=\"container row mt-4 mb-4\">\r\n        <div className=\"col-md-3\"></div>\r\n        <div className=\"col-md-6\">\r\n          <h3>Email xác thực</h3>\r\n          <p>Chúng tôi đã gửi mã xác minh tới email của bạn.</p>\r\n          <input type=\"text\" className=\"form-control\" value={OTPinput} onChange={(e) => { setOTPinput(e.target.value) }} />\r\n          <button className=\"btn btn-primary mt-2\" onClick={() => verifyOTP()}>Xác nhận tài khoản</button>\r\n\r\n          <a className=\"mt-2\" onClick={() => resendOTP()} > Không nhận được mã?\r\n            {disable ? `Gửi lại OTP trong ${timerCount}s` : \" Gửi lại OTP\"}\r\n          </a>\r\n\r\n        </div>\r\n        <div className=\"col-md-3\"></div>\r\n      </div>\r\n    </>\r\n  );\r\n}\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}